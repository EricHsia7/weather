<meta charset="UTF-8">
<title>Weather</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap');
#icon {
 background:#e3e3e3;
  background-size:cover;
  background-position:center;
  width:80px;
  height:80px;
  border-radius:8px;
  /*position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);*/
}
.f {
  height:85px;
  width:100%;
  display: flex;
  justify-content: center;
  align-items: center;
  /*position:absolute;
  top:80px;
  left:0px;*/
}
.card {
  background:#f5f5f5;
  background-position:center;
  background-size:cover;
  width:100%;
  height:100%;
  position:absolute;
  top:0px;
  left:0px;
  overflow:scroll;
}
.s {
  width:100%;
  height:100%;
  background:rgba(255, 255, 255, 0.3);
  -webkit-backdrop-filter: blur(8px);
backdrop-filter: blur(8px);
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction:column;
}
.g {
  /*position:absolute;
  top:160px;
  left:0px;*/
  font-size:25px;
  color:#000;
  font-family: 'Noto Sans TC', sans-serif;
  font-weight:600;
  display: flex;
  justify-content: center;
  align-items: center;
  width:100%;
  height:35px;
}
.l {
  /*position:absolute;
  left:0px;
  top:195px;*/
  width:100%;
  height:25px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size:18px;
  color:#000;
  font-family: 'Noto Sans TC', sans-serif;
  font-weight:400;
}
.k {
  /*position:absolute;
  left:0px;
  top:50px;*/
  width:100%;
  height:25px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size:18px;
  color:#000;
  font-family: 'Noto Sans TC', sans-serif;
  font-weight:300;
  
}
</style>
<div class="card">
  <div class="s">
    <div class="k"><span id="loc">---,--</span></div>
    <div class="f">
     <div id="icon"></div> 
    </div>
    <div class="g">
<span id="description">--</span>&nbsp&nbsp<span id="temp">--&deg;C</span>
    </div>
    
    <div class="l">
      最高<span id="max">--</span>&deg;C&nbsp&nbsp最低<span id="min">--</span>&deg;C
    </div>
    
  </div>
  </div>
  
  <script>
  function setcookie(cookiename,cookievalue) {
document.cookie = cookiename + '=' + cookievalue + '; max-age='+60*60;
}
function setcookier(cookienamer,cookievaluer) {
document.cookie = cookienamer + '=' + cookievaluer + '; max-age='+60*120;
}
function getCookie(cname)
{
  var name = cname + "=";
  var ca = document.cookie.split(';');
  for(var i=0; i<ca.length; i++) 
  {
    var c = ca[i].trim();
    if (c.indexOf(name)==0) return c.substring(name.length,c.length);
  }
  return "";
}


function getweather() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(getwwy);
  } else { 
    
  }
}
 
var description_a = '-' ;
var icon_b = '-' ;
var temp_c = '-' ;
var loc = '--' ;
var main = 'clouds' ;
var ct = '-' ;
var tmin = '-' ;
var tmax = '-' ;
function getwwy(position) {
  //x.innerHTML = "Latitude: " + position.coords.latitude + "<br>Longitude: " + position.coords.longitude;
  var ur = 'https://api.openweathermap.org/data/2.5/weather?lat=' + position.coords.latitude + '&lon=' + position.coords.longitude + '&lang=zh_tw&units=metric&appid=f13247a72ac10a30837e1fb819389f3d' ;
  ww=$.ajax({url:ur,async:false});
  console.log(ww.responseJSON)
  description_a = ww.responseJSON.weather[0].description ;
  icon_b = ww.responseJSON.weather[0].icon ;
  temp_c = ww.responseJSON.main.temp ;
  loc = ww.responseJSON.name ;
  main = ww.responseJSON.weather[0].main ;
  console.log(description_a + ',' + icon_b + ',' + temp_c) ;
  ct = ww.responseJSON.sys.country ;
   tmin = ww.responseJSON.main.temp_min ;
   tmax = ww.responseJSON.main.temp_max ;
  $('#icon').css({'background':'url(https://openweathermap.org/img/wn/' + icon_b + '@2x.png)','background-size':'cover','background-position':'center'});
  $('#description').html(description_a);
  $('#temp').html(Math.round(temp_c) + '&deg;C');
  $('#loc').html(loc + ',' + ct);
  $('#max').html(Math.round(tmax));
  $('#min').html(Math.round(tmin));
  $('.card').css({'background':'url(https://source.unsplash.com/1024x1024/?' + main + ')','background-position':'center','background-size':'cover'});
  setcookie('weather_loaded','1');
  setcookier('weather_data',btoa(encodeURIComponent(description_a + '@' + icon_b + '@' + temp_c + '@' + loc + '@' + main + '@' + ct + '@' + tmin + '@' + tmax)));
}

if(getCookie('weather_loaded') === "1") {
  var drt = decodeURIComponent(atob(getCookie('weather_data'))).split('@') ;
  var description_a = drt[0] ;
  var icon_b = drt[1] ;
  var temp_c = drt[2] ;
  var loc = drt[3] ;
  var main = drt[4] ;
  var ct = drt[5] ;
  var tmin = drt[6] ;
  var tmax = drt[7] ;
  $('#icon').css({'background':'url(https://openweathermap.org/img/wn/' + icon_b + '@2x.png)','background-size':'cover','background-position':'center'});
  $('#description').html(description_a);
  $('#temp').html(Math.round(temp_c) + '&deg;C');
  $('#loc').html(loc + ',' + ct);
  $('#max').html(Math.round(tmax));
  $('#min').html(Math.round(tmin));
  $('.card').css({'background':'url(https://source.unsplash.com/1024x1024/?' + main + ')','background-position':'center','background-size':'cover'});
  
  //alert('1')
}
else {
  getweather()
  //alert('2')
}
//getweather()
  </script>
